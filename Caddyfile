# =============================================================
# InfraPilot SaaS - Caddy Configuration
# =============================================================
#
# Automatic HTTPS with Let's Encrypt
# Routes: app.infrapilot.sh -> frontend, api.infrapilot.sh -> backend
#
# For local development, replace with localhost:
#   localhost:80 {
#     ...
#   }
#
# =============================================================

# Dashboard (frontend)
app.infrapilot.sh {
    # Frontend
    reverse_proxy frontend:3000

    # Compression
    encode gzip

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }
}

# API (backend)
api.infrapilot.sh {
    # Backend API
    reverse_proxy backend:8080

    # WebSocket support for agent connections
    @websocket {
        header Connection *Upgrade*
        header Upgrade websocket
    }
    reverse_proxy @websocket backend:8080

    # Security headers
    header {
        X-Content-Type-Options nosniff
        -Server
    }
}

# Marketing site (optional - can be separate)
infrapilot.sh {
    redir https://app.infrapilot.sh{uri} permanent
}
